<?xml version="1.0" encoding="utf-8"?>
<mx:WindowedApplication xmlns:mx="http://www.adobe.com/2006/mxml"
                        xmlns:maps="com.piaction.dashboard.cruiseControl.maps.*"
                        xmlns:view="com.piaction.dashboard.cruiseControl.view.*"
                        xmlns:mate="http://mate.asfusion.com/"
                        layout="vertical"
                        width="100%"
                        height="100%"
                        applicationComplete="stage.addEventListener(KeyboardEvent.KEY_DOWN, reportKeyDown)">
  <mx:Script>
    <![CDATA[
      import mx.collections.ArrayCollection;
      import com.piaction.dashboard.cruiseControl.events.MessageEvent;

      [Bindable]
      public var projects:ArrayCollection;

      private var _configurationVisible:Boolean = false;

      private function reportKeyDown(event:KeyboardEvent):void
      {
        if (event.commandKey || event.controlKey)
        {
          if (event.keyCode == Keyboard.R)
          {
            loadData();
          }
          else if (event.keyCode == Keyboard.F)
          {
            dispatchEvent(new MessageEvent(MessageEvent.FULLSCREEN));
          }
          else if (event.keyCode == Keyboard.COMMA)
          {
            _configurationVisible = !_configurationVisible;
            if (!_configurationVisible)
            {
              dispatchEvent(new MessageEvent(MessageEvent.SHOW_CONFIGURATION));
            }
          }
        }
        else if (event.shiftKey && event.keyCode == Keyboard.S)
        {
          projectContainer.muteSound(muteSound);
        }
      }

      private function loadData():void
      {
        dispatchEvent(new MessageEvent(MessageEvent.LOAD_DATA));
      }
    ]]>
  </mx:Script>
  <mx:Style source="style.css"/>
  <maps:MainEventMap />
  <mate:Listener type="{MessageEvent.REFRESH}" receive="loadData()"/>
  <view:ProjectBox id="projectContainer" projects="{projects}" width="100%" height="100%"/>
  <mx:HBox id="controls" width="100%" horizontalAlign="right" paddingTop="1" paddingBottom="1">
    <mx:LinkButton id="muteSound" label="No Sound" click="projectContainer.muteSound(muteSound)"/>
    <mx:LinkButton id="refreshLink" label="Rafraichir" click="loadData()"/>
    <mx:LinkButton id="fullScreenLink" label="Plein Ã©cran" click="dispatchEvent(new MessageEvent(MessageEvent.FULLSCREEN))"/>
    <mx:LinkButton id="settingsLink" label="Configuration" click="dispatchEvent(new MessageEvent(MessageEvent.SHOW_CONFIGURATION))"/>
  </mx:HBox>
</mx:WindowedApplication>
