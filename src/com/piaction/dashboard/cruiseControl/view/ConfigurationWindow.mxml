<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" layout="vertical" width="400" height="250" title="Configuration">
  <mx:Script>
    <![CDATA[
      import mx.events.ValidationResultEvent;
      import mx.managers.PopUpManager;
      import com.piaction.dashboard.cruiseControl.model.Preferences;
      import com.piaction.dashboard.cruiseControl.events.MessageEvent;

      [Bindable]
      public var url:String;

      [Bindable]
      public var refreshInterval:int;

      private function close():void
      {
        PopUpManager.removePopUp(this);
      }

      private function update():void
      {
        var vResult:ValidationResultEvent = urlValidator.validate();
        if (vResult.type == ValidationResultEvent.VALID)
        {
          var preferences:Preferences = Preferences.getInstance();
          preferences.dashboardUrl = urlText.text;
          preferences.refreshInterval = refreshIntervalSlider.value;
          close();
        }
      }

    ]]>
  </mx:Script>
  <mx:RegExpValidator id="urlValidator" expression="[http|file]://([a-z0-9_-]+)/(.*)" flags="ig"
                      source="{urlText}" property="text" listener="{urlText}"/>
  <mx:Form width="100%" height="100%">
    <mx:FormHeading label="Configuration"/>
    <mx:FormItem label="Cruise control URL" width="100%">
      <mx:TextInput id="urlText" width="100%" text="{url}"/>
    </mx:FormItem>
    <mx:FormItem label="Refresh (s)" width="100%">
      <mx:HSlider id="refreshIntervalSlider" width="100%"
                  allowTrackClick="true" minimum="30" maximum="300" liveDragging="true" snapInterval="30" tickInterval="30"
                  value="{refreshInterval}"
                  labels="['30s', '300s']"/>
    </mx:FormItem>
  </mx:Form>
  <mx:ControlBar width="100%" horizontalAlign="right">
    <mx:Button id="cancel" label="Annuler" click="close()"/>
    <mx:Button id="submit" label="Ok" click="update();"/>
  </mx:ControlBar>
</mx:TitleWindow>
